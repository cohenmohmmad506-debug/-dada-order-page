<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å¤§æé€Ÿä¸‹å• - VIPé€šé“ </title>
    <style>
        body {
            font-family: sans-serif;
            background: #f4f6f8;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        h2 {
            text-align: center;
            color: #1a73e8;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            margin-bottom: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            box-sizing: border-box;
        }

        .row {
            display: flex;
            gap: 10px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: #1a73e8;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>ğŸ“¦ å¤§å¤§æé€Ÿä¸‹å•ç³»ç»Ÿ </h2>
        <div class="section">
            <strong>ğŸ‘¤ ä¸“å±å•å·ä¸å‘ä»¶äºº </strong>
            <input type="text" id="orderNumber" readonly style="background:#e9ecef; font-weight:bold;">
            <div class="row">
                <input type="text" id="senderName" placeholder="å‘ä»¶äºº">
                <input type="text" id="senderPhone" placeholder="å‘ä»¶äººç”µè¯">
            </div>
        </div>
        <div class="section">
            <strong>ğŸ“ æ”¶ä»¶äººä¿¡æ¯ </strong>
            <input type="text" id="receiverName" placeholder="æ”¶ä»¶äººå§“å/å…¬å¸ (ç‚¹å‡»æŸ¥çœ‹å†å²)" required list="historyList"
                autocomplete="off">
            <datalist id="historyList"> </datalist>
            <input type="tel" id="receiverPhone" placeholder="æ”¶ä»¶äººç”µè¯" required>
            <input type="text" id="receiverAddress" placeholder="è¯¦ç»†åœ°å€" required>
        </div>
        <div class="section">
            <strong>âš–ï¸ è´§ç‰©ä¸è´¹ç”¨ </strong>
            <select id="transportMethod">
                <option value="é™†è¿">ğŸšš é™†è¿ </option>
                <option value="ç©ºè¿">âœˆï¸ ç©ºè¿ </option>
            </select>
            <input type="text" id="itemName" placeholder="ç‰©å“åç§°">
            <div class="row">
                <input type="number" id="itemWeight" placeholder="é‡é‡ (KG)">
                <input type="number" id="itemVolume" placeholder="ä½“ç§¯ (mÂ³)">
            </div>
            <input type="number" id="unloadFee" placeholder="å¸è´§è´¹ (å…ƒ)">
        </div>
        <button class="btn" onclick="submitOrder()">ğŸš€ ç¡®è®¤ä¸‹å•å¹¶å‘é€ </button>
    </div>
    <script>
        window.onload = function () {
            let last = localStorage.getItem('dada_last_order');
            let next = "001";
            if (last && !isNaN(parseInt(last))) next = String(parseInt(last) + 1).padStart(3, '0');
            document.getElementById('orderNumber').value = next;


            const urlParams = new URLSearchParams(window.location.search);
            const sName = urlParams.get('s_name');
            const sPhone = urlParams.get('s_phone');


            if (sName) {
                document.getElementById('senderName').value = sName;
                document.getElementById('senderName').readOnly = true;
                document.getElementById('senderName').style.backgroundColor = '#e9ecef';
            } else {
                document.getElementById('senderName').value = "æ•£å®¢(æœªç»‘å®š)";
            }


            if (sPhone) {
                document.getElementById('senderPhone').value = sPhone;
                document.getElementById('senderPhone').readOnly = true;
                document.getElementById('senderPhone').style.backgroundColor = '#e9ecef';
            }

            loadHistory(); // ğŸ‘‰ å°±æ˜¯åŠ è¿™ä¸€å¥ï¼å¯åŠ¨æ”¶ä»¶äººè®°å¿†å¼•æ“ï¼
        };

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('dada_history') || '[]');
            const datalist = document.getElementById('historyList');
            datalist.innerHTML = '';
            history.forEach(function (item) {
                let option = document.createElement('option');
                option.value = item.name;
                datalist.appendChild(option);
            });

            document.getElementById('receiverName').addEventListener('input', function (e) {
                const match = history.find(function (h) { return h.name === e.target.value; });
                if (match) {
                    document.getElementById('receiverPhone').value = match.phone;
                    document.getElementById('receiverAddress').value = match.address;
                }
            });
        }

        function submitOrder() {
            const rName = document.getElementById('receiverName').value;
            const rPhone = document.getElementById('receiverPhone').value;
            const rAddress = document.getElementById('receiverAddress').value;
            const sName = document.getElementById('senderName').value;
            const sPhone = document.getElementById('senderPhone').value;

            if (!sName || !sPhone) return alert("âš ï¸ è¯·å¡«å†™å‘ä»¶äººå§“åå’Œç”µè¯ï¼");
            if (!rName || !rPhone || !rAddress) return alert("âš ï¸ è¯·å®Œæ•´å¡«å†™æ”¶ä»¶äººä¿¡æ¯ï¼");

            const orderData = {
                "é€è´§å•å·": document.getElementById('orderNumber').value,
                "å‘ä»¶äºº": sName,
                "å‘ä»¶ç”µè¯": sPhone,
                "æ”¶ä»¶äºº": rName,
                "æ”¶ä»¶ç”µè¯": rPhone,
                "æ”¶ä»¶åœ°å€": rAddress,
                "è¿è¾“æ–¹å¼": document.getElementById('transportMethod').value,
                "ç‰©å“åç§°": document.getElementById('itemName').value || "æœªå¡«",
                "é‡é‡KG": document.getElementById('itemWeight').value || "0",
                "ä½“ç§¯m3": document.getElementById('itemVolume').value || "0",
                "å¸è´§è´¹": document.getElementById('unloadFee').value || "0",
                "ä¸‹å•æ—¶é—´": new Date().toLocaleString()
            };

            const URL = "https://hook.jijyun.cn/v1/accept/data/webhook_accept_first/dsAIEQiUOqmZu3D2t7kjSlGwWyLpVKYn";
            fetch(URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(orderData) })
                .then(function (res) {
                    localStorage.setItem('dada_last_order', orderData["é€è´§å•å·"]);


                    let history = JSON.parse(localStorage.getItem('dada_history') || '[]');
                    history = history.filter(function (item) { return item.name !== rName; });
                    history.unshift({ name: rName, phone: rPhone, address: rAddress });
                    if (history.length > 5) history.pop();
                    localStorage.setItem('dada_history', JSON.stringify(history));

                    alert("âœ… æˆåŠŸï¼å•å·ï¼š" + orderData["é€è´§å•å·"]);
                    window.location.reload();
                }).catch(function (e) { alert("å¼‚å¸¸ï¼š" + e.message); });
        }
    </script>
</body>

</html>
